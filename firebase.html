<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ Firebase ç•™è¨€æ¿</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        #message-form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px; }
        input, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .message-card { border-bottom: 1px solid #eee; padding: 10px 0; }
        .name { font-weight: bold; color: #333; }
        .time { font-size: 0.8em; color: #888; margin-left: 10px; }
    </style>
</head>
<body>

    <h2>ğŸ“ ç•™è¨€æ¿</h2>

    <div id="message-form">
        <input type="text" id="username" placeholder="ä½ çš„åå­—" required>
        <textarea id="content" placeholder="æƒ³èªªäº›ä»€éº¼å—ï¼Ÿ" rows="3" required></textarea>
        <button id="submit-btn">é€å‡ºç•™è¨€</button>
    </div>

    <div id="messages-container">è¼‰å…¥ä¸­...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- è«‹åœ¨æ­¤è™•è²¼ä¸Šä½ çš„ Firebase é…ç½® ---
        const firebaseConfig = {
        apiKey: "AIzaSyA8i_OQPaYxPxnlyw8PBaaiT98RPCzblQg",
        authDomain: "chat-box-fac06.firebaseapp.com",
        projectId: "chat-box-fac06",
        storageBucket: "chat-box-fac06.firebasestorage.app",
        messagingSenderId: "83529081314",
        appId: "1:83529081314:web:d05c7f3f389d5f0e6ed9bb",
        measurementId: "G-QX27493210"
        };
        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const msgCol = collection(db, "messages");

        // 1. é€å‡ºç•™è¨€çš„åŠŸèƒ½
        const submitBtn = document.getElementById('submit-btn');
        submitBtn.addEventListener('click', async () => {
            const name = document.getElementById('username').value;
            const text = document.getElementById('content').value;

            if (name && text) {
                try {
                    await addDoc(msgCol, {
                        username: name,
                        content: text,
                        createdAt: serverTimestamp() // ä½¿ç”¨ä¼ºæœå™¨æ™‚é–“
                    });
                    document.getElementById('content').value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
                } catch (e) {
                    console.error("å¢åŠ æ–‡ä»¶å‡ºéŒ¯: ", e);
                }
            } else {
                alert("è«‹å¡«å¯«åå­—èˆ‡å…§å®¹");
            }
        });

        // 2. å³æ™‚ç›£è½è³‡æ–™åº«è®Šå‹• (Real-time updates)
        const q = query(msgCol, orderBy("createdAt", "desc"));
        onSnapshot(q, (snapshot) => {
            const container = document.getElementById('messages-container');
            container.innerHTML = ''; // æ¸…ç©ºèˆŠå…§å®¹
            
            snapshot.forEach((doc) => {
                const data = doc.data();
                const date = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : "å‚³é€ä¸­...";
                
                const div = document.createElement('div');
                div.className = 'message-card';
                div.innerHTML = `
                    <span class="name">${data.username}</span>
                    <span class="time">${date}</span>
                    <p>${data.content}</p>
                `;
                container.appendChild(div);
            });
        });
    </script>
</body>
</html>